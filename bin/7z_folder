#!/bin/bash

if [ ${#@} -lt 2 ]; then
  >&2 echo "Error: Missing arguments"
  >&2 echo "Pattern: $(basename "$0") <extension> <folder1> <folder2> ..."
  exit 1
fi

exts=(7z zip)
ext=$1
if [[ ! " ${exts[@]} " =~ " $ext " ]]; then
  >&2 echo "Error: Invalid extension";
  >&2 echo "Available extension ${exts[@]}"
  exit 1;
fi

for f in "${@:2}"; do
  [ ! -d "$f" ] && { >&2 echo "Error: $f is not a directory"; continue; }
  case "$ext" in
    7z) 7z a "$f.7z" "$f"/*;;
    zip) 7z a "$f.zip" "$f"/*;;
    # gzip) 7z a -t$ext "$f" "$f"/*;;
    # bzip2) 7z a "$f.tar.bz2" "$f"/*;;
    # lzip) 7z a "$f.tar.lz" "$f"/*;;
    # tar) 7z a "$f.tar" "$f"/*;;
  esac
done
